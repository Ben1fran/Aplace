<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Bird</title>
<style>
    canvas {
        border: 2px solid black;
        display: block;
        margin: 0 auto;
        background-color: #4fc3f7; /* Set background color to blue */
    }

    .popup {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 9999;
    }

    .popup-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #fff;
        padding: 20px;
        text-align: center;
        border-radius: 5px;
    }

    @keyframes slideIn {
        from {
            transform: translateY(-100%);
        }
        to {
            transform: translateY(0);
        }
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    .popup.slide-in {
        animation: slideIn 0.5s forwards;
    }

    .popup.fade-in {
        animation: fadeIn 0.5s forwards;
    }
</style>
</head>
<body>
<canvas id="gameCanvas" width="320" height="480"></canvas>
<div id="popup" class="popup">
    <div class="popup-content">
        <p id="popup-message"></p>
        <button id="play-again-btn">Play Again</button>
        <button id="quit-btn">Quit</button>
    </div>
</div>
<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const bird = {
        x: 50,
        y: canvas.height / 2,
        radius: 15,
        velocity: 0,
        gravity: 0.2,
        jump: -4 // Adjusted jump velocity
    };
    const tunnel = {
        x: canvas.width,
        gap: 120,
        width: 80,
        heightTop: Math.random() * (canvas.height - 200) + 50 // Random height for top tunnel
    };
    let score = 0;
    let gameover = false;
    let passedTunnel = false; // Flag to track if bird has passed through the tunnel

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Adjust bird's position based on velocity
        bird.y += bird.velocity;

        // Draw bird
        ctx.fillStyle = "#FF5733";
        ctx.beginPath();
        ctx.arc(bird.x, bird.y, bird.radius, 0, Math.PI * 2);
        ctx.fill();

        // Draw bird eyes
        ctx.fillStyle = "white";
        ctx.beginPath();
        ctx.arc(bird.x - 5, bird.y - 5 - Math.abs(bird.velocity), 3, 0, Math.PI * 2);
        ctx.fill();
        ctx.beginPath();
        ctx.arc(bird.x + 5, bird.y - 5 - Math.abs(bird.velocity), 3, 0, Math.PI * 2);
        ctx.fill();

        // Draw bird beak
        ctx.fillStyle = "orange";
        ctx.beginPath();
        ctx.moveTo(bird.x + 10, bird.y - Math.abs(bird.velocity));
        ctx.lineTo(bird.x + 20, bird.y + 5 - Math.abs(bird.velocity));
        ctx.lineTo(bird.x + 10, bird.y + 10 - Math.abs(bird.velocity));
        ctx.fill();

        // Draw top tunnel
        ctx.fillStyle = "#008000";
        ctx.fillRect(tunnel.x, 0, tunnel.width, tunnel.heightTop);

        // Draw bottom tunnel
        const heightBottom = canvas.height - tunnel.heightTop - tunnel.gap;
        ctx.fillRect(tunnel.x, canvas.height - heightBottom, tunnel.width, heightBottom);

        // Draw border lines
        ctx.strokeStyle = "black";
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(canvas.width, 0);
        ctx.moveTo(0, canvas.height);
        ctx.lineTo(canvas.width, canvas.height);
        ctx.stroke();

        // Collision detection
        if (bird.y - bird.radius < 0 || bird.y + bird.radius > canvas.height ||
            (bird.x + bird.radius > tunnel.x && bird.x - bird.radius < tunnel.x + tunnel.width &&
            (bird.y - bird.radius < tunnel.heightTop || bird.y + bird.radius > canvas.height - heightBottom))) {
            gameOver();
        } else if (bird.x + bird.radius > tunnel.x && bird.x - bird.radius < tunnel.x + tunnel.width) {
            if (bird.y - bird.radius < tunnel.heightTop || bird.y + bird.radius > canvas.height - heightBottom) {
                gameOver();
            } else if (!passedTunnel && bird.x > tunnel.x + tunnel.width) { // Increment score when bird passes through tunnel
                score++;
                passedTunnel = true;
            }
        } else {
            passedTunnel = false;
        }

        // Draw score
        ctx.fillStyle = "#000";
        ctx.font = "24px Arial";
        ctx.fillText("Score: " + score, 10, 30);

        if (!gameover) {
            requestAnimationFrame(draw);
        }
    }

    function gameOver() {
        gameover = true;
        bird.gravity = 0.5; // Adjust the gravity to make the bird fall faster

        const popup = document.getElementById("popup");
        const popupMessage = document.getElementById("popup-message");

        popupMessage.textContent = "Game Over! Your score is: " + score;
        popup.classList.add("fade-in", "slide-in");
        popup.style.display = "block";

        const playAgainBtn = document.getElementById("play-again-btn");
        const quitBtn = document.getElementById("quit-btn");

        playAgainBtn.addEventListener("click", function() {
            location.reload(); // Reload the page to restart the game
        });

        quitBtn.addEventListener("click", function() {
            alert("Thanks for playing!");
        });
    }

    function jump() {
        bird.velocity = bird.jump;
    }

    document.addEventListener("keydown", function(event) {
        if (event.keyCode === 32) {
            jump();
        }
    });

    canvas.addEventListener("click", function() {
        if (!gameover) {
            jump();
        } else {
            location.reload(); // Reload the page to restart the game
        }
    });

    function update() {
        if (!gameover) {
            bird.velocity += bird.gravity;

            // Limit bird's velocity to prevent excessive speed
            if (bird.velocity > 5) {
                bird.velocity = 5;
            }

            // Adjust tunnel position
            tunnel.x -= 2;

            // Reset tunnel position and generate new height if it goes off-screen
            if (tunnel.x + tunnel.width < 0) {
                tunnel.x = canvas.width;
                tunnel.heightTop = Math.random() * (canvas.height - 200) + 50;
                passedTunnel = false; // Reset the flag when a new tunnel appears
            }
        }
    }

    setInterval(update, 20); // Update the game every 20 milliseconds
    draw(); // Start the game loop

    // Show instructions to tap the screen to play
    ctx.fillStyle = "#000";
    ctx.font = "20px Arial";
    ctx.fillText("Press the screen to start", 50, canvas.height / 2);

</script>
</body>
</html>